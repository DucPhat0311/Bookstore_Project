<UserControl x:Class="QUAN_LY.View.AdminView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             mc:Ignorable="d" 
             d:DesignHeight="700" d:DesignWidth="1000"
             Background="White">

    <UserControl.Resources>
        <BooleanToVisibilityConverter x:Key="StandardBoolToVisConverter"/>

        <Style x:Key="AdminItemStyle" TargetType="ListViewItem">
            <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
            <Setter Property="VerticalContentAlignment" Value="Center"/>
            <Setter Property="Margin" Value="0,2"/>
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ListViewItem">
                        <Border x:Name="Border" 
                                Background="{TemplateBinding Background}" 
                                BorderBrush="#E0E0E0" 
                                BorderThickness="0,0,0,1" 
                                CornerRadius="4"
                                Padding="8">
                            <GridViewRowPresenter VerticalAlignment="{TemplateBinding VerticalContentAlignment}"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="Border" Property="Background" Value="#F5F5F5"/>
                            </Trigger>
                            <Trigger Property="IsSelected" Value="True">
                                <Setter TargetName="Border" Property="Background" Value="#E3F2FD"/>
                                <Setter TargetName="Border" Property="BorderBrush" Value="#2196F3"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </UserControl.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <Grid Grid.Row="0" Margin="20">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="300"/>
            </Grid.ColumnDefinitions>

            <TextBlock Text="Quản Lý Nhân Sự" FontSize="24" FontWeight="Bold" 
                       VerticalAlignment="Center" Foreground="#333"/>

            <TextBox Grid.Column="1" 
                     Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}"
                     materialDesign:HintAssist.Hint="Tìm kiếm nhân viên..."
                     Style="{StaticResource MaterialDesignFloatingHintTextBox}"
                     materialDesign:TextFieldAssist.HasClearButton="True"/>
        </Grid>

        <ListView Grid.Row="1" ItemsSource="{Binding AdminList}" 
                  SelectedItem="{Binding SelectedAdmin}"
                  ItemContainerStyle="{StaticResource AdminItemStyle}"
                  Margin="20,0,20,0" 
                  ScrollViewer.HorizontalScrollBarVisibility="Disabled">
            <ListView.View>
                <GridView>
                    <GridViewColumn Header="ID" Width="50" DisplayMemberBinding="{Binding AdminId}"/>

                    <GridViewColumn Header="Họ Tên" Width="200" DisplayMemberBinding="{Binding Name}"/>

                    <GridViewColumn Header="Tên Đăng Nhập" Width="180" DisplayMemberBinding="{Binding Username}"/>

                    <GridViewColumn Header="Chức Vụ" Width="150" DisplayMemberBinding="{Binding Role}"/>

                    <GridViewColumn Header="Hoạt Động" Width="150">
                        <GridViewColumn.CellTemplate>
                            <DataTemplate>
                                <Grid Width="100">
                                    <CheckBox IsChecked="{Binding IsActive}" 
                                              IsEnabled="False" 
                                              HorizontalAlignment="Center"/>
                                </Grid>
                            </DataTemplate>
                        </GridViewColumn.CellTemplate>
                    </GridViewColumn>
                </GridView>
            </ListView.View>
        </ListView>

        <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Right" Margin="20">
            <Button Content="Xóa Nhân Viên" 
                    Command="{Binding DeleteCommand}"
                    Style="{StaticResource MaterialDesignOutlinedButton}"
                    Foreground="Red" BorderBrush="Red"
                    Margin="0,0,10,0"/>

            <Button Content="Thêm Mới" 
                    Command="{Binding OpenAddCommand}"
                    Style="{StaticResource MaterialDesignRaisedButton}"/>
        </StackPanel>

        <Grid Grid.Row="0" Grid.RowSpan="3" 
              Panel.ZIndex="999"
              Background="#99000000" 
              Visibility="{Binding IsAdding, Converter={StaticResource StandardBoolToVisConverter}}">

            <Border Background="White" Width="400" VerticalAlignment="Center" HorizontalAlignment="Center"
                    CornerRadius="10" Padding="25"
                    MouseDown="Border_MouseDown">
                <Border.Effect>
                    <DropShadowEffect BlurRadius="20" ShadowDepth="5" Opacity="0.3"/>
                </Border.Effect>

                <StackPanel>
                    <TextBlock Text="Thêm Nhân Viên Mới" FontSize="20" FontWeight="Bold" Margin="0,0,0,20" HorizontalAlignment="Center"/>

                    <TextBox Text="{Binding NewAdmin.Name, UpdateSourceTrigger=PropertyChanged}"
                             materialDesign:HintAssist.Hint="Họ và tên"
                             Style="{StaticResource MaterialDesignFloatingHintTextBox}" Margin="0,0,0,15"/>

                    <TextBox Text="{Binding NewAdmin.Username, UpdateSourceTrigger=PropertyChanged}"
                             materialDesign:HintAssist.Hint="Tên đăng nhập"
                             Style="{StaticResource MaterialDesignFloatingHintTextBox}" Margin="0,0,0,15"/>

                    <PasswordBox x:Name="txtNewPassword"
                                 materialDesign:HintAssist.Hint="Mật khẩu (tối thiểu 6 ký tự)"
                                 Style="{StaticResource MaterialDesignFloatingHintPasswordBox}" Margin="0,0,0,15"
                                 PasswordChanged="PasswordBox_PasswordChanged"/>

                    <ComboBox ItemsSource="{Binding AvailableRoles}"
                              SelectedValue="{Binding NewAdmin.Role}"
                              materialDesign:HintAssist.Hint="Chức vụ"
                              Style="{StaticResource MaterialDesignFloatingHintComboBox}" Margin="0,0,0,25">
                    </ComboBox>

                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                        <Button Content="Hủy" Command="{Binding CancelAddCommand}" 
                                Style="{StaticResource MaterialDesignFlatButton}" Margin="0,0,10,0"/>

                        <Button Content="Lưu" Command="{Binding SaveNewCommand}" Width="100"/>
                    </StackPanel>
                </StackPanel>
            </Border>
        </Grid>

        <Grid Grid.Row="0" Grid.RowSpan="3" Panel.ZIndex="1000"
              Visibility="{Binding IsLoading, Converter={StaticResource StandardBoolToVisConverter}}"
              Background="#22FFFFFF">
            <ProgressBar Style="{StaticResource MaterialDesignCircularProgressBar}" 
                         IsIndeterminate="True" Width="50" Height="50"
                         HorizontalAlignment="Center" VerticalAlignment="Center"/>
        </Grid>

    </Grid>
</UserControl>