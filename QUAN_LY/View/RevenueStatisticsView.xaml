<UserControl x:Class="QUAN_LY.View.RevenueStatisticsView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:local="clr-namespace:QUAN_LY.View"
             xmlns:liveCharts="clr-namespace:LiveCharts.Wpf;assembly=LiveCharts.Wpf"
             mc:Ignorable="d" 
             d:DesignHeight="900" d:DesignWidth="1000">

    <UserControl.Resources>
        <Style x:Key="CardStyle" TargetType="Border">
            <Setter Property="Background" Value="White"/>
            <Setter Property="CornerRadius" Value="10"/>
            <Setter Property="Margin" Value="0,0,0,20"/>
            <Setter Property="Padding" Value="15"/>
            <Setter Property="Effect">
                <Setter.Value>
                    <DropShadowEffect Color="Black" Direction="270" ShadowDepth="3" Opacity="0.1" BlurRadius="7"/>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="SectionTitle" TargetType="TextBlock">
            <Setter Property="FontSize" Value="20"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="Foreground" Value="#333"/>
            <Setter Property="Margin" Value="0,0,0,15"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
        </Style>
    </UserControl.Resources>

    <Grid>
        <Border Background="#e98345">
            <ScrollViewer VerticalScrollBarVisibility="Auto" PanningMode="VerticalOnly">
                <StackPanel Margin="20">

                    <TextBlock Text="THỐNG KÊ DOANH THU" FontSize="28" FontWeight="ExtraBold" Foreground="White" 
                               HorizontalAlignment="Center" Margin="0,10,0,30">
                        <TextBlock.Effect>
                            <DropShadowEffect ShadowDepth="2" BlurRadius="2" Opacity="0.3"/>
                        </TextBlock.Effect>
                    </TextBlock>

                    <Grid Margin="0,0,0,10">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <Border Grid.Column="0" Style="{StaticResource CardStyle}" Margin="0,0,10,20">
                            <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
                                <TextBlock Text="TỔNG DOANH THU" Foreground="#7f8c8d" FontWeight="SemiBold" HorizontalAlignment="Center"/>
                                <TextBlock Text="{Binding TotalRevenue, StringFormat={}{0:N0} VND}" 
                                           FontSize="20" FontWeight="Bold" Foreground="#27ae60" HorizontalAlignment="Center" Margin="0,5,0,0"/>
                            </StackPanel>
                        </Border>

                        <Border Grid.Column="1" Style="{StaticResource CardStyle}" Margin="5,0,5,20">
                            <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
                                <TextBlock Text="TỔNG VỐN" Foreground="#7f8c8d" FontWeight="SemiBold" HorizontalAlignment="Center"/>
                                <TextBlock Text="{Binding TotalCapital, StringFormat={}{0:N0} VND}" 
                                           FontSize="20" FontWeight="Bold" Foreground="#c0392b" HorizontalAlignment="Center" Margin="0,5,0,0"/>
                            </StackPanel>
                        </Border>

                        <Border Grid.Column="2" Style="{StaticResource CardStyle}" Margin="10,0,0,20">
                            <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
                                <TextBlock Text="TỔNG LỢI NHUẬN" Foreground="#7f8c8d" FontWeight="SemiBold" HorizontalAlignment="Center"/>
                                <TextBlock Text="{Binding TotalProfit, StringFormat={}{0:N0} VND}" 
                                           FontSize="20" FontWeight="Bold" Foreground="#f39c12" HorizontalAlignment="Center" Margin="0,5,0,0"/>
                            </StackPanel>
                        </Border>
                    </Grid>

                    <Border Style="{StaticResource CardStyle}">
                        <StackPanel>
                            <TextBlock Text="Biểu đồ so sánh hiệu quả kinh doanh" Style="{StaticResource SectionTitle}"/>

                            <liveCharts:CartesianChart Series="{Binding RevenueProfitSeries}" LegendLocation="Bottom" Height="300">
                                <liveCharts:CartesianChart.AxisX>
                                    <liveCharts:Axis Title="Thời gian" Labels="{Binding Labels}" Foreground="Black">
                                        <liveCharts:Axis.Separator>
                                            <liveCharts:Separator Step="1" StrokeThickness="0" />
                                        </liveCharts:Axis.Separator>
                                    </liveCharts:Axis>
                                </liveCharts:CartesianChart.AxisX>
                                <liveCharts:CartesianChart.AxisY>
                                    <liveCharts:Axis Title="Giá trị (VND)" LabelFormatter="{Binding Formatter}" Foreground="Black"/>
                                </liveCharts:CartesianChart.AxisY>
                            </liveCharts:CartesianChart>
                        </StackPanel>
                    </Border>

                    <Border Style="{StaticResource CardStyle}">
                        <StackPanel>
                            <DockPanel LastChildFill="True" Margin="0,0,0,10">
                                <TextBlock Text="🔥 Top 5 Sách Bán Nhiều Nhất" Style="{StaticResource SectionTitle}" DockPanel.Dock="Left" Foreground="#d35400" Margin="0"/>
                            </DockPanel>

                            <DataGrid ItemsSource="{Binding TopSellingBooks}" 
                                      AutoGenerateColumns="False" 
                                      CanUserAddRows="False" 
                                      IsReadOnly="True"
                                      HeadersVisibility="Column"
                                      RowHeight="35"
                                      BorderThickness="1" BorderBrush="#EEEEEE"
                                      GridLinesVisibility="Horizontal" HorizontalGridLinesBrush="#EEEEEE"
                                      Background="White">

                                <DataGrid.Resources>
                                    <Style TargetType="DataGridColumnHeader">
                                        <Setter Property="Background" Value="#ecf0f1"/>
                                        <Setter Property="Padding" Value="10,5,10,5"/>
                                        <Setter Property="FontWeight" Value="SemiBold"/>
                                    </Style>
                                    <Style TargetType="DataGridCell">
                                        <Setter Property="Padding" Value="10,0"/>
                                        <Setter Property="Template">
                                            <Setter.Value>
                                                <ControlTemplate TargetType="DataGridCell">
                                                    <Border Padding="{TemplateBinding Padding}" BorderBrush="{TemplateBinding BorderBrush}" BorderThickness="{TemplateBinding BorderThickness}" Background="{TemplateBinding Background}" SnapsToDevicePixels="True">
                                                        <ContentPresenter SnapsToDevicePixels="{TemplateBinding SnapsToDevicePixels}"/>
                                                    </Border>
                                                </ControlTemplate>
                                            </Setter.Value>
                                        </Setter>
                                    </Style>
                                </DataGrid.Resources>

                                <DataGrid.Columns>
                                    <DataGridTextColumn Header="TÊN SÁCH" Binding="{Binding BookTitle}" Width="*" Foreground="#2c3e50"/>
                                    <DataGridTextColumn Header="SỐ LƯỢNG BÁN" Binding="{Binding TotalSold}" Width="150" FontWeight="Bold"/>
                                </DataGrid.Columns>
                            </DataGrid>
                        </StackPanel>
                    </Border>

                    <Border Style="{StaticResource CardStyle}">
                        <StackPanel>
                            <DockPanel LastChildFill="True" Margin="0,0,0,10">
                                <TextBlock Text="❄️ Top 5 Sách Bán Ít Nhất" Style="{StaticResource SectionTitle}" DockPanel.Dock="Left" Foreground="#7f8c8d" Margin="0"/>
                            </DockPanel>

                            <DataGrid ItemsSource="{Binding LeastSellingBooks}" 
                                      AutoGenerateColumns="False" 
                                      CanUserAddRows="False" 
                                      IsReadOnly="True"
                                      HeadersVisibility="Column"
                                      RowHeight="35"
                                      BorderThickness="1" BorderBrush="#EEEEEE"
                                      GridLinesVisibility="Horizontal" HorizontalGridLinesBrush="#EEEEEE"
                                      Background="White">

                                <DataGrid.Resources>
                                    <Style TargetType="DataGridColumnHeader">
                                        <Setter Property="Background" Value="#ecf0f1"/>
                                        <Setter Property="Padding" Value="10,5,10,5"/>
                                        <Setter Property="FontWeight" Value="SemiBold"/>
                                    </Style>
                                    <Style TargetType="DataGridCell">
                                        <Setter Property="Padding" Value="10,0"/>
                                        <Setter Property="Template">
                                            <Setter.Value>
                                                <ControlTemplate TargetType="DataGridCell">
                                                    <Border Padding="{TemplateBinding Padding}" BorderBrush="{TemplateBinding BorderBrush}" BorderThickness="{TemplateBinding BorderThickness}" Background="{TemplateBinding Background}" SnapsToDevicePixels="True">
                                                        <ContentPresenter SnapsToDevicePixels="{TemplateBinding SnapsToDevicePixels}"/>
                                                    </Border>
                                                </ControlTemplate>
                                            </Setter.Value>
                                        </Setter>
                                    </Style>
                                </DataGrid.Resources>

                                <DataGrid.Columns>
                                    <DataGridTextColumn Header="TÊN SÁCH" Binding="{Binding BookTitle}" Width="*" Foreground="#2c3e50"/>
                                    <DataGridTextColumn Header="SỐ LƯỢNG BÁN" Binding="{Binding TotalSold}" Width="150" FontWeight="Bold"/>
                                </DataGrid.Columns>
                            </DataGrid>
                        </StackPanel>
                    </Border>

                </StackPanel>
            </ScrollViewer>
        </Border>
    </Grid>
</UserControl>